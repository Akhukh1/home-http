(()=>{"use strict";const t=async(t={})=>{const e=new XMLHttpRequest;e.addEventListener("load",(()=>{if(204===e.status)t.callback(e.status);else if(e.status>=200&&e.status<300)try{const n=JSON.parse(e.responseText);t.callback(n)}catch(t){console.error(t)}})),e.open(t.method,t.body),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(t.data)};class e{static list(e){t({method:"GET",body:"http://localhost:7070?method=allTickets",callback:e})}static get(e,n){t({method:"GET",body:`http://localhost:7070?method=ticketById&id=${e}`,callback:n})}static create(e,n){const c={name:e.get("name"),description:e.get("description"),status:!1,created:Date.now()},d={method:"POST",body:"http://localhost:7070?method=createTicket",callback:n,data:JSON.stringify(c)};t(d)}static update(e,n,c){const d={method:"POST",body:`http://localhost:7070?method=updateById&id=${e}`,callback:c,data:JSON.stringify(n)};t(d)}static delete(e,n){t({method:"GET",body:`http://localhost:7070?method=deleteById&id=${e}`,callback:n})}}class n{static renderFormTicket(t){const e=document.createElement("div"),n=document.body.appendChild(e);n.classList.add("popup");const c=document.createElement("form"),d=n.appendChild(c);d.classList.add("form");const i=document.createElement("div"),s=d.appendChild(i);s.classList.add("form-name"),s.textContent=t;let o=document.createElement("div"),a=d.appendChild(o);a.classList.add("input-name"),a.textContent="Краткое описание";const r=document.createElement("textarea");r.setAttribute("rows","2"),r.setAttribute("name","name"),d.appendChild(r).classList.add("short-description"),o=document.createElement("div"),a=d.appendChild(o),a.classList.add("input-name"),a.textContent="Подробное описание";const l=document.createElement("textarea");l.setAttribute("rows","3"),l.setAttribute("name","description"),d.appendChild(l).classList.add("detailed-description");const m=document.createElement("div"),u=d.appendChild(m);u.classList.add("form-buttons");let p=document.createElement("button");const h=u.appendChild(p);h.setAttribute("type","button"),h.textContent="Отмена",h.classList.add("cancel-btn"),p=document.createElement("button");const b=u.appendChild(p);b.setAttribute("type","submit"),b.textContent="ОК",b.classList.add("sumit-btn"),this.cancelFopm(e)}static cancelFopm(t){document.querySelector(".cancel-btn").addEventListener("click",(e=>{e.preventDefault(),this.removeForm(t)}))}static removeForm(t){t.remove()}}class c{static renderTicket(t,e){const n=document.createElement("div"),c=t.appendChild(n);c.classList.add("ticket-info"),c.setAttribute("id",e.id);const d=document.createElement("div"),i=c.appendChild(d);i.classList.add("ticket-container"),i.setAttribute("id",e.id);let s=document.createElement("div"),o=i.appendChild(s);o.classList.add("implement-container"),o.setAttribute("id",e.id),e.status&&(o.textContent=String.fromCharCode(10004));let a=document.createElement("div"),r=i.appendChild(a);r.classList.add("shortdescr-container"),r.setAttribute("id",e.id),r.textContent=e.name,a=document.createElement("div"),r=i.appendChild(a),r.classList.add("date-container"),r.setAttribute("id",e.id),r.textContent=new Date(e.created).toLocaleString(),s=document.createElement("div"),o=i.appendChild(s),o.classList.add("edit-container"),o.setAttribute("id",e.id),o.textContent=String.fromCharCode(9998),s=document.createElement("div"),o=i.appendChild(s),o.classList.add("delete-container"),o.setAttribute("id",e.id),o.textContent=String.fromCharCode(10006)}}const d=document.getElementById("root");new class{constructor(t){if(!(t instanceof HTMLElement))throw new Error("This is not HTML element!");this.container=t}init(){const t=document.createElement("button"),e=this.container.appendChild(t);e.textContent="Добавить тикет",e.classList.add("add-button"),e.addEventListener("click",(()=>{this.addTicket()})),this.list(this.container)}list(t){const n=document.createElement("div");this.container.appendChild(n).classList.add("tickets");const d=document.querySelector(".tickets");e.list((e=>{for(let t=0;t<e.length;t+=1)c.renderTicket(d,e[t]);this.listnerTicket(t)}))}addTicket(){function t(t){const e=document.querySelector(".tickets");c.renderTicket(e,t)}n.renderFormTicket("Добавить тикет");const d=document.querySelector(".popup"),i=document.querySelector("form");i.addEventListener("submit",(c=>{c.preventDefault();const s=new FormData(i);e.create(s,t),n.removeForm(d)}))}listnerTicket(){document.querySelector(".tickets").addEventListener("click",(t=>{if(t.target.closest(".implement-container")){const e=t.target.getAttribute("id"),n=t.target.closest(".implement-container");""===t.target.closest(".implement-container").textContent&&this.setStatus(e,n)}else if(t.target.closest(".edit-container")){const e=t.target.getAttribute("id"),n=t.target.closest(".ticket-info").querySelector(".shortdescr-container");this.changeTikcet(e,n)}else if(t.target.closest(".delete-container")){const e=t.target.getAttribute("id"),n=t.target.closest(".ticket-info");this.deleteTicket(e,n)}else if(t.target.closest(".ticket-info")){const e=t.target.closest(".ticket-info"),n=e.querySelector(".ticket-description");if(n)n.remove();else{const n=t.target.getAttribute("id");this.viewDescription(n,e)}}}))}viewDescription(t,n){const c=document.createElement("div"),d=n.appendChild(c);d.classList.add("ticket-description"),e.get(t,(t=>{t.description?d.textContent=t.description:d.textContent="Описание отсутствует"}))}setStatus(t,n){e.update(t,{status:!0},(()=>{n.textContent=String.fromCharCode(10004)}))}deleteTicket(t,n){const c=document.createElement("div"),d=document.body.appendChild(c);d.classList.add("popup");let i=document.createElement("div");const s=d.appendChild(i);s.classList.add("popup-delete"),i=document.createElement("div");const o=s.appendChild(i);o.classList.add("form-name"),o.textContent="Удалить тикет",i=document.createElement("div");const a=s.appendChild(i);a.classList.add("popup-subj"),a.textContent="Вы уверены, что зотите удалить тикет? это действие необратимо.";const r=document.createElement("div"),l=s.appendChild(r);l.classList.add("form-buttons");let m=document.createElement("button");const u=l.appendChild(m);u.setAttribute("type","button"),u.textContent="Отмена",u.classList.add("cancel-btn"),m=document.createElement("button");const p=l.appendChild(m);p.setAttribute("type","button"),p.textContent="ОК",p.classList.add("sumit-btn"),document.querySelector(".cancel-btn").addEventListener("click",(()=>{d.remove()})),document.querySelector(".sumit-btn").addEventListener("click",(()=>{e.delete(t,(t=>{204===t&&n.remove()})),d.remove()}))}changeTikcet(t,c){n.renderFormTicket("Изменить тикет");const d=document.querySelector(".popup"),i=document.querySelector("form");i.addEventListener("submit",(s=>{s.preventDefault();const o=new FormData(i);let a={};""!==o.get("name")&&(a.name=o.get("name")),""!==o.get("description")&&(a.description=o.get("description")),e.update(t,a,(e=>{const n=[...e].find((e=>e.id===t));c.textContent=n.name})),n.removeForm(d)}))}}(d).init()})();